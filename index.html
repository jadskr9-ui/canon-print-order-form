<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canon Print Service Order</title>
    <style>
        :root { --canon-red: #cc0000; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #f0f0f0; 
            padding: 20px; 
            display: flex; 
            justify-content: center; 
        }
        .card { 
            background: white; 
            max-width: 500px; 
            width: 100%;
            margin: auto; 
            padding: 25px; 
            border-radius: 10px; 
            border-top: 6px solid var(--canon-red); 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
        }
        h2 { color: var(--canon-red); text-align: center; margin-bottom: 20px; }
        .group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input, select, button { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
            box-sizing: border-box; 
        }
        .hidden { display: none; }
        button { 
            background: var(--canon-red); 
            color: white; 
            border: none; 
            font-weight: bold; 
            cursor: pointer; 
            margin-top: 15px; 
            transition: background 0.3s;
        }
        button:hover { background: #a30000; }
        .radio-box { display: flex; gap: 20px; margin-bottom: 10px; }
        hr { border: 0; border-top: 1px solid #eee; margin: 20px 0; }
    </style>
</head>
<body>

<div class="card">
    <h2>Canon Print Order Form</h2>
    <form id="orderForm">
        <div class="group">
            <label>Do you have the book file?</label>
            <div class="radio-box">
                <label><input type="radio" name="hasFile" value="yes" onclick="toggleSource(true)" required> Yes</label>
                <label><input type="radio" name="hasFile" value="no" onclick="toggleSource(false)"> No</label>
            </div>
        </div>

        <div id="fileInputDiv" class="group hidden">
            <label>Upload File (For reference only)</label>
            <input type="file" id="bookFile">
        </div>

        <div id="nameInputDiv" class="group hidden">
            <label>Book Name</label>
            <input type="text" id="bookName" placeholder="Enter book title (e.g., ISBN, Author, Title)">
        </div>

        <hr>

        <div class="group">
            <label>Number of Copies</label>
            <input type="number" id="copies" value="1" min="1" required>
        </div>

        <div class="group">
            <label>Print Type</label>
            <select id="mode">
                <option value="Black & White">Black & White</option>
                <option value="Color">Full Color</option>
            </select>
        </div>

        <hr>

        <div class="group"><label>Your Full Name</label><input type="text" id="custName" required></div>
        <div class="group"><label>Phone Number</label><input type="tel" id="custPhone" required></div>
        <div class="group"><label>Delivery Address</label><input type="text" id="custAddr" required></div>

        <button type="submit">Submit Order</button>
    </form>
</div>

<script>
    // --- Configuration ---
    // !!! CRUCIAL FIX: Added https:// protocol to the domain !!!
    const NGROK_PUBLIC_URL = 'https://tamekia-chainlike-ineludibly.ngrok-free.dev'; 
    // ---------------------
    
    // Function to show/hide file or name input
    function toggleSource(hasFile) {
        document.getElementById('fileInputDiv').classList.toggle('hidden', !hasFile);
        document.getElementById('nameInputDiv').classList.toggle('hidden', hasFile);
        // Ensure only one is required based on selection
        document.getElementById('bookName').required = !hasFile;
        document.getElementById('bookFile').required = hasFile;
    }

    // Main form submission logic
    document.getElementById('orderForm').onsubmit = async (e) => {
        e.preventDefault();
        
        // 1. Collect Data
        const fileInput = document.getElementById('bookFile');
        const bookNameInput = document.getElementById('bookName');
        
        const data = {
            customer: document.getElementById('custName').value,
            phone: document.getElementById('custPhone').value,
            address: document.getElementById('custAddr').value,
            // Get file name OR manual name
            fileNameOrBook: fileInput.files[0]?.name || bookNameInput.value || 'N/A (No file or name provided)',
            copies: document.getElementById('copies').value,
            mode: document.getElementById('mode').value
        };

        // Simple Validation Check
        if (!data.customer || !data.phone || !data.address) {
            alert("Please fill in all required fields (Name, Phone, Address).");
            return;
        }

        // 2. Send Data to YOUR Server via Ngrok
        try {
            document.querySelector('button[type="submit"]').textContent = "Sending...";
            
            const response = await fetch(`${NGROK_PUBLIC_URL}/submit-order`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            document.querySelector('button[type="submit"]').textContent = "Submit Order";

            if (response.ok) {
                alert("Order Sent Successfully! Your order has been registered.");
                // Optionally reset the form
                document.getElementById('orderForm').reset(); 
                
            } else {
                alert(`Error: Could not send order. Your server may be offline. Status: ${response.status}`);
            }
        } catch (err) {
            document.querySelector('button[type="submit"]').textContent = "Submit Order";
            alert("Network Error: Could not connect to the printing service. Please check your internet.");
            console.error("Fetch Error:", err);
        }
    };
    
    // Request notification permission on load (Optional, but good practice)
    if ("Notification" in window && Notification.permission !== "granted") {
        Notification.requestPermission();
    }
</script>

</body>
</html>
